<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Friends</title>
    <link rel="stylesheet" href="main.css">
</head>
<body>
    <p class="message" id="message"></p>

    <div class="friendslist">
        <h3>FRENS</h3>
        <span>You have no friends</span>
        <div id="referral" style="display: none;"></div>
    </div>

    <div class="btndiv">
        <button id="copyButton" class="copylink"><img src="icons/copy.png" alt=""></button>
        <button id="shareButton" class="sharelink"><img src="icons/link.png" alt="">Invite friends</button>
    </div>

    <div class="footer">
        <a class="nav-icon" href="index.html"><img src="icons/home.png" alt="">Mine</a>
        <a class="nav-icon" href="tasks.html"><img src="icons/task.png" alt="">Tasks</a>
        <a class="nav-icon" href="airdrop.html"><img src="icons/airdrop.png" alt="">Airdrop</a>
        <a class="nav-icon" href="friends.html"><img src="icons/friends.png" alt="">Frens</a>
    </div>

    <script defer>
        window.Telegram.WebApp.ready();
        const user = window.Telegram.WebApp.initDataUnsafe.user;

        // If the user is authenticated via Telegram
        if (user) {
            console.log(`User ID: ${user.id}`);
            console.log(`First Name: ${user.first_name}`);
            console.log(`Username: ${user.username}`);

            // Create and display the referral link
            createReferralLink(user.id);
        } else {
            console.log('User is not authenticated via Telegram');
        }

        function createReferralLink(userId) {
            const botUsername = 'Crowntgbot'; // Your bot's username
            const referralCode = `ref${userId}`; // Use the Telegram user ID for referral code
            const referralLink = `https://t.me/${botUsername}?start=${referralCode}`;

            // Display the referral link
            const referralDiv = document.getElementById('referral');
            referralDiv.innerText = `Your Referral Link: ${referralLink}`;
            referralDiv.style.display = 'block'; // Make the referral div visible

            // Copy the referral link when the button is clicked
            document.getElementById('copyButton').addEventListener('click', () => {
                navigator.clipboard.writeText(referralLink)
                    .then(() => showMessage('Referral link copied!'))
                    .catch(() => showMessage('Failed to copy the link!', true));
            });
        }

        // Show a message for copy success/failure
        const showMessage = (msg, isError = false) => {
            const messageElement = document.getElementById('message');
            messageElement.innerText = msg;
            messageElement.style.display = 'block';
            setTimeout(() => messageElement.style.display = 'none', 2000);
        };

        // Highlight the current navigation icon
        document.addEventListener('DOMContentLoaded', () => {
            const icons = document.querySelectorAll('.nav-icon');
            const currentPage = window.location.href.split('/').pop();
            icons.forEach(icon => {
                icon.classList.toggle('active', icon.getAttribute('href') === currentPage);
            });
        });
    </script>
</body>
</html>
