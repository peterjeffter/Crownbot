<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>friends</title>
    <link rel="stylesheet" href="main.css">
</head>
<body>
    <p class="message" id="message"></p>

        <div class="friendslist">
            <h3>FRENS</h3>
            <span>You have no friends</span>
            <div id="referral" style="display: none;">samuel tor</div>
        </div>
        <div class="btndiv">
            <button id="copyButton" class="copylink"><img src="icons/copy.png" alt=""></button>
            <button id="shareButton" class="sharelink"><img src="icons/link.png" alt="">Invite friends</button>
           </div>
        <div class="footer">
            <a class="nav-icon" href="index.html"><img src="icons/home.png" alt="" >Mine</a>
            <a class="nav-icon" href="tasks.html"><img src="icons/task.png" alt="">Tasks</a>
            <a class="nav-icon" href="airdrop.html"><img src="icons/airdrop.png" alt="">Airdrop</a>
            <a class="nav-icon" href="friends.html"><img src="icons/friends.png" alt="">Frens</a>
        </div>


        <script>
         document.addEventListener('DOMContentLoaded', () => {
    const icons = document.querySelectorAll('.nav-icon');
    const currentPage = window.location.href.split('/').pop(); // Get the current page name

    icons.forEach(icon => {
        // Ensure to check against the full href value, not just the last part
        if (icon.getAttribute('href') === currentPage) {
            icon.classList.add('active'); // Add active class to the current page icon
        } else {
            icon.classList.remove('active'); // Remove active class from other icons
        }
    });
});

document.getElementById('copyButton').addEventListener('click', function() {
            // The link you want to copy
            const link = 'nameter';

            // Use the Clipboard API to copy the link
            navigator.clipboard.writeText(link).then(() => {
                // Success message
                const messageElement = document.getElementById('message');
                messageElement.innerText = 'Link copied to clipboard!';
                messageElement.style.display = 'block';

                // Hide the message after 2 seconds
                setTimeout(() => {
                    messageElement.style.display = 'none';
                }, 2000); // 2000 milliseconds = 2 seconds
            }).catch(err => {
                // If there's an error
                const messageElement = document.getElementById('message');
                messageElement.innerText = 'Failed to copy the link!';
                messageElement.style.display = 'block';

                // Hide the error message after 2 seconds
                setTimeout(() => {
                    messageElement.style.display = 'none';
                }, 2000); // 2000 milliseconds = 2 seconds

                console.error('Could not copy text: ', err);
            });
        });

        let maxRetries = 5;
        let retries = 0;
        let socket;
        const wsURL = 'https://api.telegram.org/bot<7710762858:AAH5ZFjQRCC1yX4Y1VBA1Qrgez2hhPVL32M>/sendMessage'; // Replace with the actual Telegram WebSocket URL

        // Function to connect to WebSocket
        function connectWebSocket() {
            console.log(`Connecting to WebSocket (attempt ${retries + 1}/${maxRetries})...`);
            
            socket = new WebSocket(wsURL);

            socket.onopen = () => {
                console.log('WebSocket connection established.');
                retries = 0; // Reset retries on successful connection
            };

            socket.onmessage = (event) => {
                console.log('Received message:', event.data);
                // Process incoming messages here
            };

            socket.onclose = (event) => {
                console.error(`WebSocket closed. Code: ${event.code}, Reason: ${event.reason}`);
                handleWebSocketClose();
            };

            socket.onerror = (error) => {
                console.error('WebSocket error:', error.message);
                handleWebSocketClose();
            };
        }

        // Function to handle WebSocket connection failures
        function handleWebSocketClose() {
            if (retries < maxRetries) {
                retries++;
                console.log(`Retrying connection in ${retries * 2} seconds...`);
                setTimeout(connectWebSocket, retries * 2000);  // Exponential backoff
            } else {
                console.error('Max WebSocket retries reached. Falling back to HTTP polling or alternative connection.');
                fallbackToPolling(); // Call your fallback mechanism here
            }
        }

        // Fallback logic if WebSockets fail
        function fallbackToPolling() {
            console.log('Switching to fallback HTTP polling...');
            // Implement your polling mechanism here, e.g., long-polling using regular HTTP requests
            setInterval(() => {
                console.log('Polling data...');
                // Poll data from Telegram servers or another API
            }, 5000);  // Poll every 5 seconds
        }

        // Initial connection attempt
        connectWebSocket();

        // Event listener for "Share This App" button
        document.getElementById('shareButton').addEventListener('click', () => {
            const customLink = 'https://myapp.com/special-offer';  // Set your custom link here

            if (navigator.share) {
                navigator.share({
                    title: 'Check out this Telegram Mini App!',
                    text: 'I found this cool Telegram Mini App, check it out!',
                    url: customLink  // Custom URL to share
                }).then(() => {
                    console.log('Thanks for sharing!');
                }).catch(err => {
                    console.error('Error sharing:', err);
                });
            } else {
                console.error('Web Share API not supported in this browser.');
            }
        });

        </script>
</body>
</html>
